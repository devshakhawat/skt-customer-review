// gstm-admin-js
jQuery(function ($) {
  $(".icons-with-title").next().hide();
  $(".icons-with-title").first().next().show();
  $(".icons-with-title").on("click", function () {
    $(this).next().toggle();
  });

  $('.gstm-filed-lists input[type="checkbox"]').on("change", function () {
    $selector = $(".gsp-testimonial-form ." + this.name);
    this.checked ? $selector.slideDown(200) : $selector.slideUp(200);
  });

  function setCookie(name, value, milliseconds) {
    const now = new Date();
    now.setTime(now.getTime() + milliseconds);
    const expires = "expires=" + now.toUTCString();
    document.cookie = name + "=" + value + ";" + expires + ";path=/";
  }

  function getCookie(name) {
    const value = `${document.cookie}`;
    const parts = value.split(`${name}=`);

    if (parts.length === 2) return parts.pop().split(`${name}=`).shift();
    return null;
  }

  let activeTab = getCookie("activeTab");
  if (activeTab !== null) {
    $("." + activeTab).addClass("active");
  } else {
    $(".form-editor").addClass("active");
  }

  const tabs = $(".gstm-form-header > div");
  tabs.on("click", function () {
    tabs.removeClass("active");
    $(this).addClass("active");

    setCookie("activeTab", $(this).attr("class").split(" ")[0], 100000);

    $(".gstm-contents > div").removeClass("active");

    $(this)
      .parent()
      .siblings()
      .find("." + $(this).attr("class").split(" ")[0])
      .addClass("active");
  });

  var $statusTabs = $(".status-tabs > div");
  var $statusTabContents = $(".status-tab-contents > div");

  $statusTabContents.hide().first().show();
  $statusTabs.first().addClass("active");

  $statusTabs.click(function () {
    $statusTabs.removeClass("active");
    $(this).addClass("active");

    var index = $(this).index();
    $statusTabContents.hide().eq(index).show();
  });

  const colorPickerIds = [
    "#gstm_label_color",
    "#gstm_input_color",
    "#gstm_bg_color",
    "#gstm_btn_color",
    "#gstm_btn_hover",
    "#gstm_btn_bg",
    "#gstm_btn_bg_hover",
    "#gstm_empty_color",
    "#gstm_hover_color",
    "#gstm_star_color",
    "#gstm_submit_button",
    "#gstm_submit_btn_hover",
    "#gstm_submit_btn_bg",
    "#gstm_submit_btn_bg_hover",
    "#gstm_form_background",
    "#gstm_border_color",
    "#gstm_box_shadow_color",
  ];

  colorPickerIds.forEach((id) => {
    $(id).wpColorPicker();
  });

  $(".gstm_type_one, .gstm_type_two").slideDown();

  // Show the correct tab content based on the selected radio button
  $('input[name="record_video"]').on("change", function () {
    if ($("#record_video").is(":checked")) {
      $(".gstm_type_one").show();
      $(".gstm_type_two").hide();
    } else if ($("#video_by_url").is(":checked")) {
      $(".gstm_type_one").hide();
      $(".gstm_type_two").show();
    }
  });

  function toggleInputLabel() {
    if ($("#toggle-switch").is(":checked")) {
      $(".input-label").show();
    } else {
      $(".input-label").hide();
    }
  }
  // Initial check on page load
  toggleInputLabel();

  // Event listener for checkbox change
  $("#toggle-switch").change(function () {
    toggleInputLabel();
  });

  // Trigger change event on page load to show the correct tab content
  $('input[name="record_video"]:checked').trigger("change");

  let redirectOption = $(".redirect_option").val();

  if (redirectOption == "new-page") {
    $(".gstm-pages").show();
    $(".success-message").hide();
    $(".gstm-redirect-url").hide();
  } else if (redirectOption == "custom-url") {
    $(".gstm-pages").hide();
    $(".success-message").hide();
    $(".gstm-redirect-url").show();
  } else if (redirectOption == "same-page") {
    $(".gstm-pages").hide();
    $(".success-message").show();
    $(".gstm-redirect-url").hide();
  }

  $(".redirect_option").on("change", function () {
    let redirect = $(this).val();

    switch (redirect) {
      case "new-page":
        $(".gstm-pages").show();
        $(".success-message").hide();
        $(".gstm-redirect-url").hide();
        break;
      case "custom-url":
        $(".gstm-pages").hide();
        $(".success-message").hide();
        $(".gstm-redirect-url").show();
        break;
      case "same-page":
        $(".gstm-pages").hide();
        $(".success-message").show();
        $(".gstm-redirect-url").hide();
        break;
    }
  });

  // Trigger change event on page load to show the correct tab content
  const $popupBtn = $(".popup-btn");
  const $gstmBtnLabel = $(".gstm-btn-label");
  const $displayModeInput = $('input[name="display_mode"]');

  function getCheckedValue() {
    const radios = document.querySelectorAll('input[name="display_mode"]');
    let selectedValue;
    radios.forEach((radio) => {
      if (radio.checked) {
        selectedValue = radio.value;
      }
    });
    return selectedValue;
  }

  function updateDisplayMode(displayMode) {
    if (displayMode === "popup") {
      $popupBtn.slideDown();
      $gstmBtnLabel.slideDown();
    } else if (displayMode === "on_page") {
      $popupBtn.slideUp();
      $gstmBtnLabel.slideUp();
    }
  }

  // Initial check on page load
  updateDisplayMode(getCheckedValue());

  // Event listener for changes
  $displayModeInput.on("change", function () {
    updateDisplayMode($(this).val());
  });

  let ajax_submit = $('.gstm-switch input[name="ajax_toggle"]').is(":checked");

  // Trigger change event on page load to show the correct tab content
  function toggleAdmin() {
    if ($("#admin_toggle").is(":checked")) {
      $(
        ".gstm-notification-to, .gstm-notification-from, .gstm-notification-subject, .gstm-notification-message"
      ).slideDown();
    } else {
      $(
        ".gstm-notification-to, .gstm-notification-from, .gstm-notification-subject, .gstm-notification-message"
      ).slideUp();
    }
  }
  toggleAdmin();

  $("#admin_toggle").change(function () {
    toggleAdmin();
  });

  // Awaiting Notification Tab
  function toggleAwaiting() {
    if ($("#awaiting_notification").is(":checked")) {
      $(
        ".awaiting-notification-to, .awaiting-notification-from, .awaiting-notification-subject, .awaiting-notification-message"
      ).slideDown();
    } else {
      $(
        ".awaiting-notification-to, .awaiting-notification-from, .awaiting-notification-subject, .awaiting-notification-message"
      ).slideUp();
    }
  }
  toggleAwaiting();

  $("#awaiting_notification").change(function () {
    toggleAwaiting();
  });

  // Awaiting Notification Tab
  function toggleApproval() {
    if ($("#approval_notification").is(":checked")) {
      $(
        ".approval-notification-to, .approval-notification-from, .approval-notification-subject, .approval-notification-message"
      ).slideDown();
    } else {
      $(
        ".approval-notification-to, .approval-notification-from, .approval-notification-subject, .approval-notification-message"
      ).slideUp();
    }
  }
  toggleApproval();

  $("#approval_notification").change(function () {
    toggleApproval();
  });

  function toggleShadow() {
    if ($(".box-shadow-none").is(":checked")) {
      $(".gstm_shadow_values").slideUp();
    } else {
      $(".gstm_shadow_values").slideDown();
    }
  }
  toggleShadow();

  $(".box-shadow").change(function () {
    toggleShadow();
  });

  $(".copytoclip").on("click", function (e) {
    e.preventDefault();

    let copyText = $(".gstm_shortcode").text();

    if (navigator.clipboard) {
      navigator.clipboard
        .writeText(copyText)
        .then(function () {
          $(".gstm_copy").text("Copied!");
          $(".copytoclip").addClass("gstm_copied");

          setTimeout(function () {
            $(".gstm_copy").text("Copy");
            $(".copytoclip").removeClass("gstm_copied");
          }, 3000);
        })
        .catch(function (err) {
          console.error("Could not copy text: ", err);
        });
    } else {
      console.error("Clipboard API not supported");
    }
  });
});
