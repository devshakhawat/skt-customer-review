jQuery(function ($) {
  $(".gstm_categories_list").select2();

  $(".gstm_popup_text").magnificPopup({
    type: "inline",
    midClick: true,
  });

  if (typeof gstm_form_submission === "undefined") return;

  if (gstm_form_submission.ajax_toggle) {
    let form_id = "#" + gstm_form_submission.id;

    $(form_id).on("submit", function (e) {
      e.preventDefault();

      var formData = new FormData(this);
      formData.append("action", "gstm_save_testimonial");
      formData.append("_wpnonce", gstm_form_submission.nonce);
      formData.append("form_id", gstm_form_submission.form_id);

      $.ajax({
        url: gstm_form_submission.ajax_url,
        type: "POST",
        cache: false,
        dataType: "JSON",
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          $("#gstm_form_submission").trigger("reset");
          if (gstm_form_submission.redirect_url) {
            // redirect
            window.location.href = gstm_form_submission.redirect_url;
          } else {
            $(".gstm_shortcode_template").append(
              response.data.message ? response.data.message : ""
            );
            setTimeout(function () {
              $(".gstm_shortcode_template").remove();
            }, 3000);
          }
        }
      });
    });
  }
});
