jQuery((function(e){let t=document.getElementById("sktpr_preview");let n=document.getElementById("sktpr_recording");let o=document.getElementById("sktpr_timer-text");let i=document.getElementById("sktpr_startButton");let l=document.getElementById("sktpr_stopButton");let r=document.getElementById("sktpr_addButton");let a={audio:{noiseSuppression:false},video:{width:{min:480,ideal:800,max:1280},height:{min:320,ideal:470,max:720},framerate:30}};var s=document.getElementById("sktpr_video_modal");var d=document.getElementById("sktpr_modal_btn");var c=document.getElementsByClassName("sktpr_modal_close")[0];var p=document.getElementsByClassName("sktpr_no_camera")[0];var u=document.getElementsByClassName("sktpr_background")[0];if(d){u.onclick=function(){c.click()};c.onclick=function(){s.style.display="none";n.style.display="none";r.style.display="none"};window.onclick=function(e){if(e.target==s){s.style.display="none"}};let B=o.getAttribute("data-maxtime");let h=1e3*60*B;var y=null;function m(e,t){var n=e,o,i;y=setInterval((function(){o=parseInt(n/60,10);i=parseInt(n%60,10);o=o<10?"0"+o:o;i=i<10?"0"+i:i;t.innerHTML=o+`:`+i;t.style.display="inline-block";if(--n<0){n=e;clearInterval(y);l.click()}}),1e3)}t.controls=false;n.controls=false;var f;var v=[];var k=null;var _="video/webm";d.onclick=function(n){n.preventDefault();s.style.display="block";t.style.display="block";i.style.display="block";if(!navigator.mediaDevices.getUserMedia){alert("navigator.mediaDevices.getUserMedia not supported on your browser, use the latest version of Firefox or Chrome");p.style.display="flex";e(".sktpr_record_video_buttons").css({display:"none"})}else{if(window.MediaRecorder==undefined){alert("MediaRecorder not supported on your browser, use the latest version of Firefox or Chrome");p.style.display="flex";e(".sktpr_record_video_buttons").css({display:"none"})}else{navigator.mediaDevices.getUserMedia(a).then((function(e){k=e;t.srcObject=k;t.play();try{window.AudioContext=window.AudioContext||window.webkitAudioContext;window.audioContext=new AudioContext}catch(e){console.log("Web Audio API not supported.")}})).catch((function(t){p.style.display="flex";e(".sktpr_record_video_buttons").css({display:"none"})}))}}};function b(){if(k==null){alert("Could not get local stream from mic/camera")}else{i.disabled=true;l.disabled=false;v=[];if(typeof MediaRecorder.isTypeSupported=="function"){if(MediaRecorder.isTypeSupported("video/webm")){var e={mimeType:"video/webm"}}else if(MediaRecorder.isTypeSupported("video/mp4")){_="video/mp4";var e={mimeType:"video/mp4",videoBitsPerSecond:25e5}}f=new MediaRecorder(k,e)}else{f=new MediaRecorder(k)}f.ondataavailable=function(e){if(e.data&&e.data.size>0){v.push(e.data)}};f.onstart=function(){var e=h/1e3;m(e,o)};f.onstop=function(){var e=new Blob(v,{type:f.mimeType});r.href=URL.createObjectURL(e);n.src=URL.createObjectURL(e);n.controls=true;var t=Math.floor(Math.random()*1e7);switch(_){case"video/mp4":var o="video-testimonial-"+t+".mp4";break;default:var o="video-testimonial-"+t+".webm"}r.addEventListener("click",(t=>{t.preventDefault();n.style.display="none";r.style.display="none";document.getElementById("sktpr_startButton_text").innerText="Start Recording";let i=new File([e],o,{type:e.type});let l=new DataTransfer;l.items.add(i);document.querySelector("#sktpr_client_video_upload").files=l.files;document.querySelector(".skt-video-wrapper video").src=r.href;document.querySelector(".skt-video-wrapper").style.display="block";c.click()}));r.setAttribute("download",o);r.setAttribute("name",o)};f.start(200)}}i.addEventListener("click",(()=>{p.style.display="none";t.style.display="block";n.style.display="none";i.style.display="none";l.style.display="inline-block";b()}));l.addEventListener("click",(()=>{r.style.display="inline-block";t.style.display="none";n.style.display="block";o.style.display="none";l.style.display="none";i.style.display="block";document.getElementById("sktpr_startButton_text").innerText="Record again";clearInterval(y);o.innerText="";g()}),false);function g(){f.stop();i.disabled=false;l.disabled=true}}let w=e("#commentform");if(w.length){w.attr("enctype","multipart/form-data")}e("form.comment-form").on("submit",(function(t){var n=typeof sktpr_settings!=="undefined"?sktpr_settings:{};if(n.required_video_recording==="1"&&e("#sktpr_client_video_upload")[0].files.length===0&&e(".skt-video-wrapper video").attr("src")===undefined){t.preventDefault();alert("Please record a video testimonial before submitting your review.");return false}if(n.required_file_upload==="1"&&e("#sktpr_file_upload")[0].files.length===0&&e(".inp_file_video").attr("src")===undefined){t.preventDefault();alert("Please upload a video file before submitting your review.");return false}}))}));
