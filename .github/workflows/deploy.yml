name: Deploy to WordPress.org

on:
  push:
    tags:
      - "v*"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

        # Cache Node modules to speed up builds
      - name: Cache Node modules
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Build assets
        run:  npm install && npm run prod

      - name: WordPress Plugin Deploy
        uses: 10up/action-wordpress-plugin-deploy@stable
        env:
          SVN_USERNAME: ${{ secrets.SVN_USERNAME }}
          SVN_PASSWORD: ${{ secrets.SVN_PASSWORD }}
          SLUG: product-reviews
          EXCLUDE: |
            build.sh
            mix-manifest.json
            webpack.config.js
            node_modules
            webpack.mix.js
            .babelrc
            .eslintrc.json
            .stylelintrc.json
            .gitignore
            package.json
            package-lock.json
            composer.json
            composer.lock
            .github
            dev
            QWEN.md
            REMINDER_FIXES.md
            VIDEO_REVIEWS_FEATURE.md